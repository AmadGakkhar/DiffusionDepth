Complete day-summary – from first “python -m src.main” to a running NYU baseline
==============================================================================

0.  Goal  
    • Reproduce DiffusionDepth “depth-only” baseline on NYU-v2.

1.  Clean conda environment  
    • Created `pytorch110` (Python 3.8).  
    • Installed official wheels:  
      – torch 1.10.2 + cu113, torchvision 0.11.3 + cu113, torchaudio 0.10.2 + cu113.  
    • Installed `mmcv-full 1.3.13` built for torch 1.10/cu113.

2.  Package stack for DiffusionDepth  
    • `mmdet 2.14.0` (plain PyPI).  
    • **Built from source** `mmdetection3d` at tag **v0.15.0** (`MMCV_WITH_OPS=1 pip install -e .`).  
    • Extra runtime deps: `opencv-python-headless 4.7.0.72`, `nuscenes-devkit 1.1.9`, `tensorboard 2.11`.

3.  Pre-trained weights  
    • Downloaded `swin_large_patch4_window7_224_22k.pth` to `pretrain/`.  
    • Updated `src/model/backbone/swin.py` paths.

4.  CUDA architecture mismatch fix  
    • Replaced earlier torch 1.10.0+cu102 with torch 1.10.2+cu113 to support RTX A6000 (sm_86).

5.  TorchVision missing  
    • Installed matching `torchvision 0.11.3+cu113`.

6.  Recurrent errors & how they were solved  

| Error encountered | Root cause | Fix implemented |
|-------------------|-----------|-----------------|
| `ModuleNotFoundError: torchvision` | TorchVision hadn’t been installed after switching torch builds. | Installed exact-match wheel `torchvision 0.11.3+cu113`. |
| `CUDA capability sm_86 is not compatible` | torch wheel compiled for CUDA 10.2 | Re-installed cu113 wheels as above. |
| `ModuleNotFoundError: model` when running `swin_check.py` | Running test from repo root; `src/` not on `PYTHONPATH`. | Added `sys.path.insert(0, "src")` or ran script from `src/`. |
| `unrecognized arguments: --local_rank` | Tried to launch with `torch.distributed.launch`; DiffusionDepth spawns its own processes. | Dropped `torchrun`; launched with plain `python main.py …`. |
| `AttributeError: module 'distutils' has no attribute 'version'` (during `from torch.utils.tensorboard import SummaryWriter`) | New setuptools shim removes `distutils.version`. | Two-part fix: ① set `export SETUPTOOLS_USE_DISTUTILS=stdlib` in `~/.bashrc`; ② pre-load sub-module by editing `src/summary/__init__.py`: `import importlib, distutils; importlib.import_module('distutils.version')`. |
| `pip resolver conflict (setuptools>=60 required)` | Earlier attempt to downgrade setuptools. | Kept modern `setuptools` (≥67) and relied on the env-variable shim instead. |
| `ModuleNotFoundError: mmengine` | Installed latest mmdet3d which now depends on MMEngine. | Removed it and installed `mmdet3d v0.15.0` which matches mmcv-1.x. |

7.  Swin backbone sanity test  
```python
from importlib import import_module
swin = import_module('src.model.backbone.swin')
net  = swin.swin_large_naive_l4w722422k()
print('#params (M):', sum(p.numel() for p in net.parameters())/1e6)
```
Output shows pretrained weights loaded and ~198 M parameters – confirming model path and environment are correct.

8.  Final launch command (single GPU example)  
```bash
cd DiffusionDepth-Orig/src
python main.py \
  --dir_data /mnt/data/nyudepthv2 \
  --data_name NYU \
  --split_json ../data_json/nyu.json \
  --patch_height 228 --patch_width 304 \
  --gpus 0 \
  --model_name Diffusion_DCbase_ \
  --backbone_module mmbev_resnet \
  --backbone_name mmbev_res18 \
  --head_specify DDIMDepthEstimate_Res \
  --loss 1.0*L1+1.0*L2+1.0*DDIM \
  --epochs 30 \
  --batch_size 4 \
  --max_depth 10.0 \
  --save nyu_res18_baseline
```

9.  Current status  
    • Training starts; epoch/step logs written to `experiments/YYMMDD_HHMMSS_nyu_res18_baseline/`.  
    • TensorBoard writer works; can be viewed with `tensorboard --logdir experiments --bind_all`.

10. Next steps (after baseline finishes)  
    • Verify validation metrics ≈ RMSE 0.46 / REL 0.14 for NYU.  
    • Optionally rerun with Swin backbone on multiple GPUs.  
    • Move to `exp_plan.txt` Step 2: add semantic segmentation masks and extend the dataloader/model for multi-task training.

This consolidated summary captures every error hit today and the corresponding fix, plus the final repeatable environment setup and training command.